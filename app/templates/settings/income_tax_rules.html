{% extends "base.html" %}
{% block content %}
<div class="container py-3">
  <h3 class="mb-3">Φόρος Εισοδήματος</h3>

  <div class="card mb-4">
    <div class="card-header"><strong>Νέος Κανόνας</strong></div>
    <div class="card-body">
      <form method="post" action="{{ request.path }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="action" value="create">

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Περιγραφή</label>
            <input name="description" class="form-control" required>
          </div>

          <div class="col-md-2">
            <label class="form-label">ΦΕ %</label>
            <input name="rate_percent" class="form-control" placeholder="8" required>
          </div>

          <div class="col-md-2">
            <label class="form-label">Όριο (€)</label>
            <input name="threshold_amount" class="form-control" value="150" required>
          </div>

          <div class="col-md-2 d-flex align-items-end">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="is_active" id="active_new" checked>
              <label class="form-check-label" for="active_new">Ενεργό</label>
            </div>
          </div>

          <div class="col-12">
            <button class="btn btn-primary">Προσθήκη</button>
          </div>
        </div>
      </form>
      <div class="form-text mt-2">
        Το ΦΕ εφαρμόζεται μόνο όταν Σύνολο (προ ΦΠΑ) &gt; Όριο. Υπολογισμός: (Σύνολο - Κρατήσεις) * ΦΕ%.
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header"><strong>Υπάρχοντες Κανόνες</strong></div>
    <div class="card-body">
      {% if rules %}
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>Περιγραφή</th>
              <th style="width: 120px;">ΦΕ %</th>
              <th style="width: 140px;">Όριο (€)</th>
              <th style="width: 90px;">Ενεργό</th>
              <th style="width: 220px;" class="text-end">Ενέργειες</th>
            </tr>
          </thead>
          <tbody>
            {% for r in rules %}
            <tr>
              <td>
                <form method="post" action="{{ request.path }}" class="d-flex gap-2">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="action" value="update">
                  <input type="hidden" name="id" value="{{ r.id }}">
                  <input name="description" class="form-control form-control-sm" value="{{ r.description }}" required>
              </td>

              <td>
                <input name="rate_percent" class="form-control form-control-sm" value="{{ r.rate_percent }}">
              </td>

              <td>
                <input name="threshold_amount" class="form-control form-control-sm" value="{{ r.threshold_amount }}">
              </td>

              <td>
                <input type="checkbox" name="is_active" {% if r.is_active %}checked{% endif %}>
              </td>

              <td class="text-end">
                  <button class="btn btn-sm btn-outline-primary">Αποθήκευση</button>
                </form>

                <form method="post" action="{{ request.path }}" class="d-inline">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="action" value="delete">
                  <input type="hidden" name="id" value="{{ r.id }}">
                  <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Διαγραφή;');">Διαγραφή</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <div class="alert alert-info mb-0">Δεν υπάρχουν κανόνες.</div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}