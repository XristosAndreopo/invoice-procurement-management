{% extends "base.html" %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h1 class="h4 fw-bold mb-1">Επεξεργασία Χρήστη</h1>
    <div class="text-muted small">
      Διαχείριση ρόλων, υπηρεσίας, κατάστασης και σύνδεσης με Προσωπικό.
    </div>
  </div>
  <a href="{{ url_for('users.list_users') }}" class="btn btn-outline-secondary btn-sm">
    &larr; Πίσω στη λίστα
  </a>
</div>

<div class="card glass-card shadow-sm border-0">
  <div class="card-body">
    <div class="row g-3">
      <!-- LEFT: FORM -->
      <div class="col-12 col-lg-8">
        <form method="post">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

          <div class="mb-2 row align-items-center">
            <label class="col-4 col-form-label col-form-label-sm">Username</label>
            <div class="col-8">
              <input type="text" class="form-control form-control-sm" value="{{ user.username }}" disabled>
            </div>
          </div>

          <div class="mb-2 row align-items-center">
            <label class="col-4 col-form-label col-form-label-sm">Νέο Password</label>
            <div class="col-8">
              <input type="password" name="password" class="form-control form-control-sm">
              <div class="form-text">
                Αν συμπληρωθεί, θα αντικαταστήσει το τρέχον password.
              </div>
            </div>
          </div>

          <hr class="my-3">

          <div class="mb-2 row align-items-center">
            <label class="col-4 col-form-label col-form-label-sm">Προσωπικό (1-1) *</label>
            <div class="col-8">
              <select name="personnel_id" class="form-select form-select-sm" required>
                <option value="">(επιλέξτε)</option>
                {% for p in personnel_list %}
                  <option value="{{ p.id }}" {% if user.personnel_id == p.id %}selected{% endif %}>
                    {{ p.full_name() }} {% if p.agm %}• ΑΓΜ: {{ p.agm }}{% endif %}
                  </option>
                {% endfor %}
              </select>
              <div class="form-text">
                Επιτρέπεται μόνο ενεργό προσωπικό χωρίς user (ή το ήδη συνδεδεμένο).
              </div>
            </div>
          </div>

          <div class="mb-2 row align-items-center">
            <label class="col-4 col-form-label col-form-label-sm">Υπηρεσία</label>
            <div class="col-8">
              <select name="service_unit_id" class="form-select form-select-sm">
                <option value="">(καμία)</option>
                {% for su in service_units %}
                  <option value="{{ su.id }}" {% if user.service_unit_id == su.id %}selected{% endif %}>
                    {{ su.short_name or su.description }}
                  </option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="mb-2 row align-items-center">
            <label class="col-4 col-form-label col-form-label-sm">Δικαιώματα</label>
            <div class="col-8">
              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" name="is_admin" id="is_admin"
                       {% if user.is_admin %}checked{% endif %}>
                <label class="form-check-label" for="is_admin">Administrator</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="is_active" id="is_active"
                       {% if user.is_active %}checked{% endif %}>
                <label class="form-check-label" for="is_active">Ενεργός Χρήστης</label>
              </div>
            </div>
          </div>

          <div class="mt-3">
            <button class="btn btn-primary btn-sm">
              Αποθήκευση Αλλαγών
            </button>
          </div>
        </form>
      </div>

      <!-- RIGHT: INFO -->
      <div class="col-12 col-lg-4">
        <div class="card bg-light border-0 h-100">
          <div class="card-body py-3 small">
            <div class="fw-bold mb-2">Σημείωση</div>
            <ul class="mb-0">
              <li>Η υπηρεσία καθορίζει την απομόνωση δεδομένων (service isolation).</li>
              <li>Manager/Deputy καθορίζεται από την Υπηρεσία (ServiceUnit) μέσω Προσωπικού.</li>
              <li>Αν απενεργοποιήσεις χρήστη, δεν μπορεί να κάνει login.</li>
              <li>Αν αλλάξεις σύνδεση Προσωπικού, κρατάς την 1-1 σχέση.</li>
            </ul>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}