{# 
Base layout for all pages.

Top:
  - Black navbar with "Procurement Management" on the left
  - Logged-in username on the right

Below:
  - If logged in: left sidebar (sections + pages) + main content on the right
  - If not logged in: main content full width

Logout ("Έξοδος") is at the BOTTOM of the sidebar.
Footer is sticky at bottom of the viewport thanks to flex layout.

IMPORTANT: block "content" is defined only once at the bottom.
#}
<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ config.APP_NAME }}</title>

  <!-- Bootstrap 5 CSS from CDN -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <!-- Custom app styles (cache-busted) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='app.css', v='2026-03-02') }}">
</head>
<body class="bg-app {% if current_user.is_authenticated %}theme-{{ current_user.theme or 'default' }}{% else %}theme-default{% endif %} d-flex flex-column min-vh-100">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
  <div class="container-fluid">
    {# Brand: Procurement Management on the top left #}
    <a class="navbar-brand fw-semibold" href="{{ url_for('procurements.list_procurements') }}">
      {{ config.APP_NAME }}
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navMain">
      <div class="me-auto"></div>

      {# RIGHT SIDE: username OR login link (logout is now in sidebar) #}
      <ul class="navbar-nav ms-auto">
        {% if current_user.is_authenticated %}
          <li class="nav-item me-2">
            <span class="nav-link text-light opacity-75">
              {{ current_user.username }}
            </span>
          </li>
        {% else %}
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('auth.login') }}">Σύνδεση</a>
          </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

{# flex-grow-1 makes main stretch and pushes footer to bottom #}
<main class="container-fluid py-4 flex-grow-1">
  <div class="row">
    {% if current_user.is_authenticated %}
      {# LEFT SIDEBAR: visible only when logged in #}
      <aside class="col-12 col-md-3 col-lg-2 mb-3 mb-md-0">
        <div class="card sidebar-card shadow-sm border-0">
          <div class="list-group list-group-flush sidebar-nav">
            {% for section in nav_sections %}
              {% set section_id = 'nav-section-' ~ loop.index %}

              {% set ns = namespace(active=false) %}
              {% for item in section["items"] %}
                {% if request.endpoint == item["endpoint"] %}
                  {% set ns.active = true %}
                {% endif %}
              {% endfor %}

              <div class="sidebar-section">
                <button
                  class="list-group-item list-group-item-action d-flex justify-content-between align-items-center sidebar-section-header {% if ns.active %}section-open{% endif %}"
                  data-bs-toggle="collapse"
                  data-bs-target="#{{ section_id }}"
                  aria-expanded="{{ 'true' if ns.active else 'false' }}"
                  type="button"
                >
                  <span>{{ section["label"] }}</span>
                  <span class="sidebar-caret">&#9662;</span>
                </button>

                <div
                  id="{{ section_id }}"
                  class="collapse {% if ns.active %}show{% endif %}"
                >
                  {% for item in section["items"] %}
                    <a
                      class="list-group-item list-group-item-action ps-4 sidebar-link {% if request.endpoint == item['endpoint'] %}active{% endif %}"
                      href="{{ url_for(item['endpoint']) }}"
                    >
                      {{ item["label"] }}
                    </a>
                  {% endfor %}
                </div>
              </div>
            {% endfor %}
          </div>

          {# LOGOUT at the very bottom of the sidebar #}
          <div class="sidebar-footer border-top">
            <a href="{{ url_for('auth.logout') }}" class="sidebar-logout-link d-flex align-items-center">
              <span class="me-2">⏻</span>
              <span>Έξοδος</span>
            </a>
          </div>
        </div>
      </aside>

      {% set content_col_classes = "col-12 col-md-9 col-lg-10" %}
    {% else %}
      {% set content_col_classes = "col-12" %}
    {% endif %}

    <section class="{{ content_col_classes }}">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="mb-3">
            {% for category, msg in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ msg }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </section>
  </div>
</main>

<footer class="container pb-4">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-center small text-muted gap-2">
    <div>
      Εσωτερικό εργαλείο • Flask
    </div>
    <div class="d-flex align-items-center gap-3">
      <a href="mailto:you@example.com" class="footer-link d-inline-flex align-items-center">
        <span class="footer-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16">
            <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v.217l-8 4.8-8-4.8V4z"/>
            <path d="M0 5.383v6.617A2 2 0 0 0 2 14h12a2 2 0 0 0 2-2V5.383l-7.555 4.533a1 1 0 0 1-1.022 0L0 5.383z"/>
          </svg>
        </span>
        <span class="ms-1">you@example.com</span>
      </a>

      <a href="https://github.com/yourusername" target="_blank" class="footer-link d-inline-flex align-items-center">
        <span class="footer-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16">
            <path d="M8 0C3.58 0 0 3.58 0 8a8 8 0 0 0 5.47 7.59c.4.07.55-.17.55-.38
                     0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13
                     -.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52
                     .28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95
                     0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12
                     0 0 .67-.21 2.2.82A7.65 7.65 0 0 1 8 3.5
                     c.68.003 1.37.092 2.01.27 1.53-1.04 2.2-.82 2.2-.82
                     .44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15
                     0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48
                     0 1.07-.01 1.93-.01 2.19 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8
                     c0-4.42-3.58-8-8-8z"/>
          </svg>
        </span>
        <span class="ms-1">GitHub</span>
      </a>

      <a href="https://www.linkedin.com/in/yourprofile" target="_blank" class="footer-link d-inline-flex align-items-center">
        <span class="footer-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 16 16">
            <path d="M1.146 1.146C1.54.752 2.074.5 2.667.5c.593 0 1.127.252 1.52.646.394.394.647.928.647 1.52
                     0 .593-.253 1.127-.647 1.52A2.144 2.144 0 0 1 2.667 4.833
                     c-.593 0-1.127-.253-1.52-.647A2.144 2.144 0 0 1 .5 2.667c0-.593.252-1.127.646-1.52zM.667 6h4v9.333h-4V6zm5.333 0h3.833v1.227h.053
                     c.534-.96 1.837-1.973 3.78-1.973C15.94 5.254 16 7.427 16 9.88V15.333h-4V10.44
                     c0-1.166-.02-2.667-1.627-2.667-1.627 0-1.877 1.27-1.877 2.58v4.98h-4V6z"/>
          </svg>
        </span>
        <span class="ms-1">LinkedIn</span>
      </a>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>